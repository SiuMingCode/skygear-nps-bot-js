'use strict';

const skygearCloud = require('skygear/cloud');
const { DEVELOPMENT_MODE } = require('./config');
const { closeSurveys, distributeScheduledSurveys, handleOAuth, handleCommand, handleAction, handleEvent } = require('./handlers');

/**
 * Check availability after a git push
 */
skygearCloud.handler('ping', req => 'Hello, world\n', {
  method: ['GET'],
  userRequired: false
});

/**
 * Test any new feature here
 */
skygearCloud.handler('dev', req => {}, {
  method: ['GET'],
  userRequired: false
});

let interval = DEVELOPMENT_MODE ? '@every 1m' : '@every 1h';
skygearCloud.every(interval, () => {
  closeSurveys();
  distributeScheduledSurveys();
});

skygearCloud.handler('oauth', handleOAuth, {
  method: ['GET'],
  userRequired: false
});

skygearCloud.handler('command', handleCommand, {
  method: ['POST'],
  userRequired: false
});

skygearCloud.handler('action', handleAction, {
  method: ['POST'],
  userRequired: false
});

skygearCloud.handler('event', handleEvent, {
  method: ['POST'],
  userRequired: false
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJza3lnZWFyQ2xvdWQiLCJyZXF1aXJlIiwiREVWRUxPUE1FTlRfTU9ERSIsImNsb3NlU3VydmV5cyIsImRpc3RyaWJ1dGVTY2hlZHVsZWRTdXJ2ZXlzIiwiaGFuZGxlT0F1dGgiLCJoYW5kbGVDb21tYW5kIiwiaGFuZGxlQWN0aW9uIiwiaGFuZGxlRXZlbnQiLCJoYW5kbGVyIiwicmVxIiwibWV0aG9kIiwidXNlclJlcXVpcmVkIiwiaW50ZXJ2YWwiLCJldmVyeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNQSxlQUFlQyxRQUFRLGVBQVIsQ0FBckI7QUFDQSxNQUFNLEVBQUVDLGdCQUFGLEtBQXVCRCxRQUFRLFVBQVIsQ0FBN0I7QUFDQSxNQUFNLEVBQUVFLFlBQUYsRUFBZ0JDLDBCQUFoQixFQUE0Q0MsV0FBNUMsRUFBeURDLGFBQXpELEVBQXdFQyxZQUF4RSxFQUFzRkMsV0FBdEYsS0FBc0dQLFFBQVEsWUFBUixDQUE1Rzs7QUFFQTs7O0FBR0FELGFBQWFTLE9BQWIsQ0FBcUIsTUFBckIsRUFBNkJDLE9BQU8sZ0JBQXBDLEVBQXNEO0FBQ3BEQyxVQUFRLENBQUMsS0FBRCxDQUQ0QztBQUVwREMsZ0JBQWM7QUFGc0MsQ0FBdEQ7O0FBS0E7OztBQUdBWixhQUFhUyxPQUFiLENBQXFCLEtBQXJCLEVBQTRCQyxPQUFPLENBRWxDLENBRkQsRUFFRztBQUNEQyxVQUFRLENBQUMsS0FBRCxDQURQO0FBRURDLGdCQUFjO0FBRmIsQ0FGSDs7QUFPQSxJQUFJQyxXQUFXWCxtQkFBbUIsV0FBbkIsR0FBaUMsV0FBaEQ7QUFDQUYsYUFBYWMsS0FBYixDQUFtQkQsUUFBbkIsRUFBNkIsTUFBTTtBQUNqQ1Y7QUFDQUM7QUFDRCxDQUhEOztBQUtBSixhQUFhUyxPQUFiLENBQXFCLE9BQXJCLEVBQThCSixXQUE5QixFQUEyQztBQUN6Q00sVUFBUSxDQUFDLEtBQUQsQ0FEaUM7QUFFekNDLGdCQUFjO0FBRjJCLENBQTNDOztBQUtBWixhQUFhUyxPQUFiLENBQXFCLFNBQXJCLEVBQWdDSCxhQUFoQyxFQUErQztBQUM3Q0ssVUFBUSxDQUFDLE1BQUQsQ0FEcUM7QUFFN0NDLGdCQUFjO0FBRitCLENBQS9DOztBQUtBWixhQUFhUyxPQUFiLENBQXFCLFFBQXJCLEVBQStCRixZQUEvQixFQUE2QztBQUMzQ0ksVUFBUSxDQUFDLE1BQUQsQ0FEbUM7QUFFM0NDLGdCQUFjO0FBRjZCLENBQTdDOztBQUtBWixhQUFhUyxPQUFiLENBQXFCLE9BQXJCLEVBQThCRCxXQUE5QixFQUEyQztBQUN6Q0csVUFBUSxDQUFDLE1BQUQsQ0FEaUM7QUFFekNDLGdCQUFjO0FBRjJCLENBQTNDIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgc2t5Z2VhckNsb3VkID0gcmVxdWlyZSgnc2t5Z2Vhci9jbG91ZCcpXG5jb25zdCB7IERFVkVMT1BNRU5UX01PREUgfSA9IHJlcXVpcmUoJy4vY29uZmlnJylcbmNvbnN0IHsgY2xvc2VTdXJ2ZXlzLCBkaXN0cmlidXRlU2NoZWR1bGVkU3VydmV5cywgaGFuZGxlT0F1dGgsIGhhbmRsZUNvbW1hbmQsIGhhbmRsZUFjdGlvbiwgaGFuZGxlRXZlbnQgfSA9IHJlcXVpcmUoJy4vaGFuZGxlcnMnKVxuXG4vKipcbiAqIENoZWNrIGF2YWlsYWJpbGl0eSBhZnRlciBhIGdpdCBwdXNoXG4gKi9cbnNreWdlYXJDbG91ZC5oYW5kbGVyKCdwaW5nJywgcmVxID0+ICdIZWxsbywgd29ybGRcXG4nLCB7XG4gIG1ldGhvZDogWydHRVQnXSxcbiAgdXNlclJlcXVpcmVkOiBmYWxzZVxufSlcblxuLyoqXG4gKiBUZXN0IGFueSBuZXcgZmVhdHVyZSBoZXJlXG4gKi9cbnNreWdlYXJDbG91ZC5oYW5kbGVyKCdkZXYnLCByZXEgPT4ge1xuXG59LCB7XG4gIG1ldGhvZDogWydHRVQnXSxcbiAgdXNlclJlcXVpcmVkOiBmYWxzZVxufSlcblxubGV0IGludGVydmFsID0gREVWRUxPUE1FTlRfTU9ERSA/ICdAZXZlcnkgMW0nIDogJ0BldmVyeSAxaCdcbnNreWdlYXJDbG91ZC5ldmVyeShpbnRlcnZhbCwgKCkgPT4ge1xuICBjbG9zZVN1cnZleXMoKVxuICBkaXN0cmlidXRlU2NoZWR1bGVkU3VydmV5cygpXG59KVxuXG5za3lnZWFyQ2xvdWQuaGFuZGxlcignb2F1dGgnLCBoYW5kbGVPQXV0aCwge1xuICBtZXRob2Q6IFsnR0VUJ10sXG4gIHVzZXJSZXF1aXJlZDogZmFsc2Vcbn0pXG5cbnNreWdlYXJDbG91ZC5oYW5kbGVyKCdjb21tYW5kJywgaGFuZGxlQ29tbWFuZCwge1xuICBtZXRob2Q6IFsnUE9TVCddLFxuICB1c2VyUmVxdWlyZWQ6IGZhbHNlXG59KVxuXG5za3lnZWFyQ2xvdWQuaGFuZGxlcignYWN0aW9uJywgaGFuZGxlQWN0aW9uLCB7XG4gIG1ldGhvZDogWydQT1NUJ10sXG4gIHVzZXJSZXF1aXJlZDogZmFsc2Vcbn0pXG5cbnNreWdlYXJDbG91ZC5oYW5kbGVyKCdldmVudCcsIGhhbmRsZUV2ZW50LCB7XG4gIG1ldGhvZDogWydQT1NUJ10sXG4gIHVzZXJSZXF1aXJlZDogZmFsc2Vcbn0pXG4iXX0=