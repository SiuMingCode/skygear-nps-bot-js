'use strict';

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step("next", value); }, function (err) { step("throw", err); }); } } return step("next"); }); }; }

const { WebClient } = require('@slack/client');
const { extractIDs } = require('./util');

/**
 * @see https://api.slack.com/methods
 */
class Bot {
  constructor(token) {
    this._client = new WebClient(token);
  }

  fetchUser(id) {
    return this._client.users.info(id).then(res => res.user);
  }

  fetchUsers() {
    // neither a bot or a former employee
    return this._client.users.list().then(res => res.members.filter(member => !(member.is_bot || member.name === 'slackbot' || member.deleted)));
  }

  fetchAdmins() {
    return this.fetchUsers().then(users => users.filter(user => user.is_admin));
  }

  fetchIMs() {
    return this._client.im.list().then(res => res.ims);
  }

  fetchIMOf(userID) {
    return this.fetchIMs().then(ims => ims.find(im => im.user === userID));
  }

  fetchIMsOf(usersID) {
    return this.fetchIMs().then(ims => ims.filter(im => usersID.includes(im.user)));
  }

  sendToUser(id, message) {
    var _this = this;

    return _asyncToGenerator(function* () {
      let targetIMID = (yield _this.fetchIMOf(id)).id;
      _this._client.chat.postMessage(targetIMID, message);
    })();
  }

  sendToUsers(ids, message) {
    var _this2 = this;

    return _asyncToGenerator(function* () {
      let targetsIMID = extractIDs((yield _this2.fetchIMsOf(ids)));
      targetsIMID.forEach(function (targetIMID) {
        _this2._client.chat.postMessage(targetIMID, message);
      });
    })();
  }

  sendToAdmins(message) {
    var _this3 = this;

    return _asyncToGenerator(function* () {
      let adminsID = extractIDs((yield _this3.fetchAdmins()));
      _this3.sendToUsers(adminsID, message);
    })();
  }

  sendToChannel(id, message) {
    this._client.chat.postMessage(id, message);
  }

  distribute(survey) {
    var _this4 = this;

    return _asyncToGenerator(function* () {
      let targetsIMID = extractIDs((yield _this4.fetchIMsOf(survey.targetsID)));
      targetsIMID.forEach(function (targetIMID) {
        _this4._client.chat.postMessage(targetIMID, 'How likely is it you would recommend this company as a place to work', {
          attachments: [{
            text: 'Choose a score from 10 (hightest) to 1 (lowest)',
            fallback: 'You are unable to select a score',
            callback_id: 'saveScoreAndRequestReason',
            actions: [{
              name: 'scores',
              type: 'select',
              options: [{
                text: '10',
                value: JSON.stringify({
                  score: 10,
                  surveyID: survey.id
                })
              }, {
                text: '9',
                value: JSON.stringify({
                  score: 9,
                  surveyID: survey.id
                })
              }, {
                text: '8',
                value: JSON.stringify({
                  score: 8,
                  surveyID: survey.id
                })
              }, {
                text: '7',
                value: JSON.stringify({
                  score: 7,
                  surveyID: survey.id
                })
              }, {
                text: '6',
                value: JSON.stringify({
                  score: 6,
                  surveyID: survey.id
                })
              }, {
                text: '5',
                value: JSON.stringify({
                  score: 5,
                  surveyID: survey.id
                })
              }, {
                text: '4',
                value: JSON.stringify({
                  score: 4,
                  surveyID: survey.id
                })
              }, {
                text: '3',
                value: JSON.stringify({
                  score: 3,
                  surveyID: survey.id
                })
              }, {
                text: '2',
                value: JSON.stringify({
                  score: 2,
                  surveyID: survey.id
                })
              }, {
                text: '1',
                value: JSON.stringify({
                  score: 1,
                  surveyID: survey.id
                })
              }]
            }]
          }]
        });
      });
      survey.isSent = true;
      survey.update();
    })();
  }
}

module.exports = Bot;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9ib3QuanMiXSwibmFtZXMiOlsiV2ViQ2xpZW50IiwicmVxdWlyZSIsImV4dHJhY3RJRHMiLCJCb3QiLCJjb25zdHJ1Y3RvciIsInRva2VuIiwiX2NsaWVudCIsImZldGNoVXNlciIsImlkIiwidXNlcnMiLCJpbmZvIiwidGhlbiIsInJlcyIsInVzZXIiLCJmZXRjaFVzZXJzIiwibGlzdCIsIm1lbWJlcnMiLCJmaWx0ZXIiLCJtZW1iZXIiLCJpc19ib3QiLCJuYW1lIiwiZGVsZXRlZCIsImZldGNoQWRtaW5zIiwiaXNfYWRtaW4iLCJmZXRjaElNcyIsImltIiwiaW1zIiwiZmV0Y2hJTU9mIiwidXNlcklEIiwiZmluZCIsImZldGNoSU1zT2YiLCJ1c2Vyc0lEIiwiaW5jbHVkZXMiLCJzZW5kVG9Vc2VyIiwibWVzc2FnZSIsInRhcmdldElNSUQiLCJjaGF0IiwicG9zdE1lc3NhZ2UiLCJzZW5kVG9Vc2VycyIsImlkcyIsInRhcmdldHNJTUlEIiwiZm9yRWFjaCIsInNlbmRUb0FkbWlucyIsImFkbWluc0lEIiwic2VuZFRvQ2hhbm5lbCIsImRpc3RyaWJ1dGUiLCJzdXJ2ZXkiLCJ0YXJnZXRzSUQiLCJhdHRhY2htZW50cyIsInRleHQiLCJmYWxsYmFjayIsImNhbGxiYWNrX2lkIiwiYWN0aW9ucyIsInR5cGUiLCJvcHRpb25zIiwidmFsdWUiLCJKU09OIiwic3RyaW5naWZ5Iiwic2NvcmUiLCJzdXJ2ZXlJRCIsImlzU2VudCIsInVwZGF0ZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxNQUFNLEVBQUVBLFNBQUYsS0FBZ0JDLFFBQVEsZUFBUixDQUF0QjtBQUNBLE1BQU0sRUFBRUMsVUFBRixLQUFpQkQsUUFBUSxRQUFSLENBQXZCOztBQUVBOzs7QUFHQSxNQUFNRSxHQUFOLENBQVU7QUFDUkMsY0FBYUMsS0FBYixFQUFvQjtBQUNsQixTQUFLQyxPQUFMLEdBQWUsSUFBSU4sU0FBSixDQUFjSyxLQUFkLENBQWY7QUFD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RUFrRFA7QUFDRXlDLHNCQUFNLEdBRFI7QUFFRU0sdUJBQU9DLEtBQUtDLFNBQUwsQ0FBZTtBQUNwQkMseUJBQU8sQ0FEYTtBQUVwQkMsNEJBQVViLE9BQU90QztBQUZHLGlCQUFmO0FBRlQsZUFsRE8sRUF5RFA7QUFDRXlDLHNCQUFNLEdBRFI7QUFFRU0sdUJBQU9DLEtBQUtDLFNBQUwsQ0FBZTtBQUNwQkMseUJBQU8sQ0FEYTtBQUVwQkMsNEJBQVViLE9BQU90QztBQUZHLGlCQUFmO0FBRlQsZUF6RE8sRUFnRVA7QUFDRXlDLHNCQUFNLEdBRFI7QUFFRU0sdUJBQU9DLEtBQUtDLFNBQUwsQ0FBZTtBQUNwQkMseUJBQU8sQ0FEYTtBQUVwQkMsNEJBQVViLE9BQU90QztBQUZHLGlCQUFmO0FBRlQsZUFoRU87QUFIWCxhQURPO0FBSlgsV0FEVztBQURtRyxTQUFsSDtBQXVGRCxPQXhGRDtBQXlGQXNDLGFBQU9jLE1BQVAsR0FBZ0IsSUFBaEI7QUFDQWQsYUFBT2UsTUFBUDtBQTVGd0I7QUE2RnpCO0FBaEpPOztBQW1KVkMsT0FBT0MsT0FBUCxHQUFpQjVELEdBQWpCIiwiZmlsZSI6ImJvdC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgV2ViQ2xpZW50IH0gPSByZXF1aXJlKCdAc2xhY2svY2xpZW50JylcbmNvbnN0IHsgZXh0cmFjdElEcyB9ID0gcmVxdWlyZSgnLi91dGlsJylcblxuLyoqXG4gKiBAc2VlIGh0dHBzOi8vYXBpLnNsYWNrLmNvbS9tZXRob2RzXG4gKi9cbmNsYXNzIEJvdCB7XG4gIGNvbnN0cnVjdG9yICh0b2tlbikge1xuICAgIHRoaXMuX2NsaWVudCA9IG5ldyBXZWJDbGllbnQodG9rZW4pXG4gIH1cblxuICBmZXRjaFVzZXIgKGlkKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NsaWVudC51c2Vycy5pbmZvKGlkKS50aGVuKHJlcyA9PiByZXMudXNlcilcbiAgfVxuXG4gIGZldGNoVXNlcnMgKCkge1xuICAgIC8vIG5laXRoZXIgYSBib3Qgb3IgYSBmb3JtZXIgZW1wbG95ZWVcbiAgICByZXR1cm4gdGhpcy5fY2xpZW50LnVzZXJzLmxpc3QoKS50aGVuKHJlcyA9PiByZXMubWVtYmVycy5maWx0ZXIobWVtYmVyID0+ICEobWVtYmVyLmlzX2JvdCB8fCBtZW1iZXIubmFtZSA9PT0gJ3NsYWNrYm90JyB8fCBtZW1iZXIuZGVsZXRlZCkpKVxuICB9XG5cbiAgZmV0Y2hBZG1pbnMgKCkge1xuICAgIHJldHVybiB0aGlzLmZldGNoVXNlcnMoKS50aGVuKHVzZXJzID0+IHVzZXJzLmZpbHRlcih1c2VyID0+IHVzZXIuaXNfYWRtaW4pKVxuICB9XG5cbiAgZmV0Y2hJTXMgKCkge1xuICAgIHJldHVybiB0aGlzLl9jbGllbnQuaW0ubGlzdCgpLnRoZW4ocmVzID0+IHJlcy5pbXMpXG4gIH1cblxuICBmZXRjaElNT2YgKHVzZXJJRCkge1xuICAgIHJldHVybiB0aGlzLmZldGNoSU1zKCkudGhlbihpbXMgPT4gaW1zLmZpbmQoaW0gPT4gaW0udXNlciA9PT0gdXNlcklEKSlcbiAgfVxuXG4gIGZldGNoSU1zT2YgKHVzZXJzSUQpIHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaElNcygpLnRoZW4oaW1zID0+IGltcy5maWx0ZXIoaW0gPT4gdXNlcnNJRC5pbmNsdWRlcyhpbS51c2VyKSkpXG4gIH1cblxuICBhc3luYyBzZW5kVG9Vc2VyIChpZCwgbWVzc2FnZSkge1xuICAgIGxldCB0YXJnZXRJTUlEID0gKGF3YWl0IHRoaXMuZmV0Y2hJTU9mKGlkKSkuaWRcbiAgICB0aGlzLl9jbGllbnQuY2hhdC5wb3N0TWVzc2FnZSh0YXJnZXRJTUlELCBtZXNzYWdlKVxuICB9XG5cbiAgYXN5bmMgc2VuZFRvVXNlcnMgKGlkcywgbWVzc2FnZSkge1xuICAgIGxldCB0YXJnZXRzSU1JRCA9IGV4dHJhY3RJRHMoYXdhaXQgdGhpcy5mZXRjaElNc09mKGlkcykpXG4gICAgdGFyZ2V0c0lNSUQuZm9yRWFjaCh0YXJnZXRJTUlEID0+IHtcbiAgICAgIHRoaXMuX2NsaWVudC5jaGF0LnBvc3RNZXNzYWdlKHRhcmdldElNSUQsIG1lc3NhZ2UpXG4gICAgfSlcbiAgfVxuXG4gIGFzeW5jIHNlbmRUb0FkbWlucyAobWVzc2FnZSkge1xuICAgIGxldCBhZG1pbnNJRCA9IGV4dHJhY3RJRHMoYXdhaXQgdGhpcy5mZXRjaEFkbWlucygpKVxuICAgIHRoaXMuc2VuZFRvVXNlcnMoYWRtaW5zSUQsIG1lc3NhZ2UpXG4gIH1cblxuICBzZW5kVG9DaGFubmVsIChpZCwgbWVzc2FnZSkge1xuICAgIHRoaXMuX2NsaWVudC5jaGF0LnBvc3RNZXNzYWdlKGlkLCBtZXNzYWdlKVxuICB9XG5cbiAgYXN5bmMgZGlzdHJpYnV0ZSAoc3VydmV5KSB7XG4gICAgbGV0IHRhcmdldHNJTUlEID0gZXh0cmFjdElEcyhhd2FpdCB0aGlzLmZldGNoSU1zT2Yoc3VydmV5LnRhcmdldHNJRCkpXG4gICAgdGFyZ2V0c0lNSUQuZm9yRWFjaCh0YXJnZXRJTUlEID0+IHtcbiAgICAgIHRoaXMuX2NsaWVudC5jaGF0LnBvc3RNZXNzYWdlKHRhcmdldElNSUQsICdIb3cgbGlrZWx5IGlzIGl0IHlvdSB3b3VsZCByZWNvbW1lbmQgdGhpcyBjb21wYW55IGFzIGEgcGxhY2UgdG8gd29yaycsIHtcbiAgICAgICAgYXR0YWNobWVudHM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0ZXh0OiAnQ2hvb3NlIGEgc2NvcmUgZnJvbSAxMCAoaGlnaHRlc3QpIHRvIDEgKGxvd2VzdCknLFxuICAgICAgICAgICAgZmFsbGJhY2s6ICdZb3UgYXJlIHVuYWJsZSB0byBzZWxlY3QgYSBzY29yZScsXG4gICAgICAgICAgICBjYWxsYmFja19pZDogJ3NhdmVTY29yZUFuZFJlcXVlc3RSZWFzb24nLFxuICAgICAgICAgICAgYWN0aW9uczogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3Njb3JlcycsXG4gICAgICAgICAgICAgICAgdHlwZTogJ3NlbGVjdCcsXG4gICAgICAgICAgICAgICAgb3B0aW9uczogW1xuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnMTAnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgICAgIHNjb3JlOiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICBzdXJ2ZXlJRDogc3VydmV5LmlkXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnOScsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgICAgICAgc2NvcmU6IDksXG4gICAgICAgICAgICAgICAgICAgICAgc3VydmV5SUQ6IHN1cnZleS5pZFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJzgnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgICAgIHNjb3JlOiA4LFxuICAgICAgICAgICAgICAgICAgICAgIHN1cnZleUlEOiBzdXJ2ZXkuaWRcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICc3JyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAgICAgICBzY29yZTogNyxcbiAgICAgICAgICAgICAgICAgICAgICBzdXJ2ZXlJRDogc3VydmV5LmlkXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnNicsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgICAgICAgc2NvcmU6IDYsXG4gICAgICAgICAgICAgICAgICAgICAgc3VydmV5SUQ6IHN1cnZleS5pZFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJzUnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgICAgIHNjb3JlOiA1LFxuICAgICAgICAgICAgICAgICAgICAgIHN1cnZleUlEOiBzdXJ2ZXkuaWRcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICc0JyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAgICAgICBzY29yZTogNCxcbiAgICAgICAgICAgICAgICAgICAgICBzdXJ2ZXlJRDogc3VydmV5LmlkXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnMycsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgICAgICAgc2NvcmU6IDMsXG4gICAgICAgICAgICAgICAgICAgICAgc3VydmV5SUQ6IHN1cnZleS5pZFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJzInLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgICAgIHNjb3JlOiAyLFxuICAgICAgICAgICAgICAgICAgICAgIHN1cnZleUlEOiBzdXJ2ZXkuaWRcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICcxJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAgICAgICBzY29yZTogMSxcbiAgICAgICAgICAgICAgICAgICAgICBzdXJ2ZXlJRDogc3VydmV5LmlkXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KVxuICAgIH0pXG4gICAgc3VydmV5LmlzU2VudCA9IHRydWVcbiAgICBzdXJ2ZXkudXBkYXRlKClcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEJvdFxuIl19