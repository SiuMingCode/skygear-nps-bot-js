'use strict';

const skygear = require('skygear');
const Bot = require('./bot');
const db = require('./db');

class Team {
  constructor(record) {
    this._record = record;
  }

  static get Record() {
    return skygear.Record.extend('team');
  }

  static create(slackID, token) {
    let record = new Team.Record({ slackID, token });
    return db.save(record).then(record => new Team(record));
  }

  static of(slackID) {
    let query = new skygear.Query(Team.Record);
    query.equalTo('slackID', slackID);
    return db.query(query).then(result => {
      if (result.length > 1) {
        throw new Error('Mutiple identical team records found');
      }
      return result[0] ? new Team(result[0]) : null;
    });
  }

  get slackID() {
    return this._record['slackID'];
  }

  get token() {
    return this._record['token'];
  }

  set token(newValue) {
    this._record['token'] = newValue;
  }

  update() {
    return db.save(this._record).then(record => new Team(record));
  }

  get bot() {
    return new Bot(this.token);
  }
}

module.exports = Team;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy90ZWFtLmpzIl0sIm5hbWVzIjpbInNreWdlYXIiLCJyZXF1aXJlIiwiQm90IiwiZGIiLCJUZWFtIiwiY29uc3RydWN0b3IiLCJyZWNvcmQiLCJfcmVjb3JkIiwiUmVjb3JkIiwiZXh0ZW5kIiwiY3JlYXRlIiwic2xhY2tJRCIsInRva2VuIiwic2F2ZSIsInRoZW4iLCJvZiIsInF1ZXJ5IiwiUXVlcnkiLCJlcXVhbFRvIiwicmVzdWx0IiwibGVuZ3RoIiwiRXJyb3IiLCJuZXdWYWx1ZSIsInVwZGF0ZSIsImJvdCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTUEsVUFBVUMsUUFBUSxTQUFSLENBQWhCO0FBQ0EsTUFBTUMsTUFBTUQsUUFBUSxPQUFSLENBQVo7QUFDQSxNQUFNRSxLQUFLRixRQUFRLE1BQVIsQ0FBWDs7QUFFQSxNQUFNRyxJQUFOLENBQVc7QUFDVEMsY0FBYUMsTUFBYixFQUFxQjtBQUNuQixTQUFLQyxPQUFMLEdBQWVELE1BQWY7QUFDRDs7QUFFRCxhQUFXRSxNQUFYLEdBQXFCO0FBQ25CLFdBQU9SLFFBQVFRLE1BQVIsQ0FBZUMsTUFBZixDQUFzQixNQUF0QixDQUFQO0FBQ0Q7O0FBRUQsU0FBT0MsTUFBUCxDQUFlQyxPQUFmLEVBQXdCQyxLQUF4QixFQUErQjtBQUM3QixRQUFJTixTQUFTLElBQUlGLEtBQUtJLE1BQVQsQ0FBZ0IsRUFBRUcsT0FBRixFQUFXQyxLQUFYLEVBQWhCLENBQWI7QUFDQSxXQUFPVCxHQUFHVSxJQUFILENBQVFQLE1BQVIsRUFBZ0JRLElBQWhCLENBQXFCUixVQUFVLElBQUlGLElBQUosQ0FBU0UsTUFBVCxDQUEvQixDQUFQO0FBQ0Q7O0FBRUQsU0FBT1MsRUFBUCxDQUFXSixPQUFYLEVBQW9CO0FBQ2xCLFFBQUlLLFFBQVEsSUFBSWhCLFFBQVFpQixLQUFaLENBQWtCYixLQUFLSSxNQUF2QixDQUFaO0FBQ0FRLFVBQU1FLE9BQU4sQ0FBYyxTQUFkLEVBQXlCUCxPQUF6QjtBQUNBLFdBQU9SLEdBQUdhLEtBQUgsQ0FBU0EsS0FBVCxFQUFnQkYsSUFBaEIsQ0FBcUJLLFVBQVU7QUFDcEMsVUFBSUEsT0FBT0MsTUFBUCxHQUFnQixDQUFwQixFQUF1QjtBQUNyQixjQUFNLElBQUlDLEtBQUosQ0FBVSxzQ0FBVixDQUFOO0FBQ0Q7QUFDRCxhQUFPRixPQUFPLENBQVAsSUFBWSxJQUFJZixJQUFKLENBQVNlLE9BQU8sQ0FBUCxDQUFULENBQVosR0FBa0MsSUFBekM7QUFDRCxLQUxNLENBQVA7QUFNRDs7QUFFRCxNQUFJUixPQUFKLEdBQWU7QUFDYixXQUFPLEtBQUtKLE9BQUwsQ0FBYSxTQUFiLENBQVA7QUFDRDs7QUFFRCxNQUFJSyxLQUFKLEdBQWE7QUFDWCxXQUFPLEtBQUtMLE9BQUwsQ0FBYSxPQUFiLENBQVA7QUFDRDs7QUFFRCxNQUFJSyxLQUFKLENBQVdVLFFBQVgsRUFBcUI7QUFDbkIsU0FBS2YsT0FBTCxDQUFhLE9BQWIsSUFBd0JlLFFBQXhCO0FBQ0Q7O0FBRURDLFdBQVU7QUFDUixXQUFPcEIsR0FBR1UsSUFBSCxDQUFRLEtBQUtOLE9BQWIsRUFBc0JPLElBQXRCLENBQTJCUixVQUFVLElBQUlGLElBQUosQ0FBU0UsTUFBVCxDQUFyQyxDQUFQO0FBQ0Q7O0FBRUQsTUFBSWtCLEdBQUosR0FBVztBQUNULFdBQU8sSUFBSXRCLEdBQUosQ0FBUSxLQUFLVSxLQUFiLENBQVA7QUFDRDtBQTNDUTs7QUE4Q1hhLE9BQU9DLE9BQVAsR0FBaUJ0QixJQUFqQiIsImZpbGUiOiJ0ZWFtLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgc2t5Z2VhciA9IHJlcXVpcmUoJ3NreWdlYXInKVxuY29uc3QgQm90ID0gcmVxdWlyZSgnLi9ib3QnKVxuY29uc3QgZGIgPSByZXF1aXJlKCcuL2RiJylcblxuY2xhc3MgVGVhbSB7XG4gIGNvbnN0cnVjdG9yIChyZWNvcmQpIHtcbiAgICB0aGlzLl9yZWNvcmQgPSByZWNvcmRcbiAgfVxuXG4gIHN0YXRpYyBnZXQgUmVjb3JkICgpIHtcbiAgICByZXR1cm4gc2t5Z2Vhci5SZWNvcmQuZXh0ZW5kKCd0ZWFtJylcbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGUgKHNsYWNrSUQsIHRva2VuKSB7XG4gICAgbGV0IHJlY29yZCA9IG5ldyBUZWFtLlJlY29yZCh7IHNsYWNrSUQsIHRva2VuIH0pXG4gICAgcmV0dXJuIGRiLnNhdmUocmVjb3JkKS50aGVuKHJlY29yZCA9PiBuZXcgVGVhbShyZWNvcmQpKVxuICB9XG5cbiAgc3RhdGljIG9mIChzbGFja0lEKSB7XG4gICAgbGV0IHF1ZXJ5ID0gbmV3IHNreWdlYXIuUXVlcnkoVGVhbS5SZWNvcmQpXG4gICAgcXVlcnkuZXF1YWxUbygnc2xhY2tJRCcsIHNsYWNrSUQpXG4gICAgcmV0dXJuIGRiLnF1ZXJ5KHF1ZXJ5KS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDEpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNdXRpcGxlIGlkZW50aWNhbCB0ZWFtIHJlY29yZHMgZm91bmQnKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdFswXSA/IG5ldyBUZWFtKHJlc3VsdFswXSkgOiBudWxsXG4gICAgfSlcbiAgfVxuXG4gIGdldCBzbGFja0lEICgpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVjb3JkWydzbGFja0lEJ11cbiAgfVxuXG4gIGdldCB0b2tlbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlY29yZFsndG9rZW4nXVxuICB9XG5cbiAgc2V0IHRva2VuIChuZXdWYWx1ZSkge1xuICAgIHRoaXMuX3JlY29yZFsndG9rZW4nXSA9IG5ld1ZhbHVlXG4gIH1cblxuICB1cGRhdGUgKCkge1xuICAgIHJldHVybiBkYi5zYXZlKHRoaXMuX3JlY29yZCkudGhlbihyZWNvcmQgPT4gbmV3IFRlYW0ocmVjb3JkKSlcbiAgfVxuXG4gIGdldCBib3QgKCkge1xuICAgIHJldHVybiBuZXcgQm90KHRoaXMudG9rZW4pXG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBUZWFtXG4iXX0=