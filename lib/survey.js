'use strict';

const skygear = require('skygear');
const db = require('./db');

class Survey {
  constructor(record) {
    this._record = record;
  }

  static get Record() {
    return skygear.Record.extend('survey');
  }

  static create(teamID, frequency, excludedUsersID, scheduledDatetime) {
    let isSent = false;
    let isClosed = false;
    let record = new Survey.Record({
      teamID,
      frequency,
      excludedUsersID,
      scheduledDatetime,
      isSent,
      isClosed
    });
    return db.save(record).then(record => new Survey(record));
  }

  static of(id) {
    let query = new skygear.Query(Survey.Record);
    query.equalTo('_id', id);
    return db.query(query).then(result => result[0] ? new Survey(result[0]) : null);
  }

  static scheduledBy(teamID) {
    let query = new skygear.Query(Survey.Record);
    query.equalTo('teamID', teamID);
    query.equalTo('isSent', false);
    return db.query(query).then(result => {
      if (result.length > 1) {
        throw new Error(`Mutiple scheduled surveys found for team ${teamID}`);
      }
      return result[0] ? new Survey(result[0]) : null;
    });
  }

  static openingIn(teamID) {
    let query = new skygear.Query(Survey.Record);
    query.equalTo('teamID', teamID);
    query.equalTo('isSent', true);
    query.equalTo('isClosed', false);
    return db.query(query).then(result => {
      if (result.length > 1) {
        throw new Error(`Mutiple opening surveys found for team ${teamID}`);
      }
      return result[0] ? new Survey(result[0]) : null;
    });
  }

  static get readyToSend() {
    let query = new skygear.Query(Survey.Record);
    query.equalTo('isSent', false);
    query.lessThanOrEqualTo('scheduledDatetime', new Date());
    return db.query(query).then(result => {
      let records = [];
      for (let i = 0; i < result.length; i++) {
        records.push(new Survey(result[i]));
      }
      return records;
    });
  }

  set isSent(newValue) {
    this._record['isSent'] = newValue;
  }

  update() {
    return db.save(this._record).then(record => new Survey(record));
  }

  get id() {
    return this._record['id'];
  }

  get teamID() {
    return this._record['teamID'];
  }

  get frequency() {
    return this._record['frequency'];
  }

  get excludedUsersID() {
    return this._record['excludedUsersID'];
  }

  get scheduledDatetime() {
    return this._record['scheduledDatetime'];
  }

  get isSent() {
    return this._record['isSent'];
  }

  get isClosed() {
    return this._record['isClosed'];
  }

  get state() {
    if (!this.isSent && !this.isClosed) {
      return 'scheduled';
    } else if (this.isSent && !this.isClosed) {
      return 'open';
    } else if (this.isSent && !this.isClosed) {
      return 'closed';
    } else {
      throw new Error('Invalid survey state');
    }
  }

  get q1() {
    return {
      text: 'How likely is it you would recommend this company as a place to work?',
      attachments: [{
        text: 'Choose a score from 10 (hightest) to 1 (lowest)',
        fallback: 'You are unable to select a score',
        callback_id: 'saveScoreAndRequestReason',
        actions: [{
          name: 'scores',
          type: 'select',
          options: [{
            text: '10',
            value: JSON.stringify({
              score: 10,
              surveyID: this.id
            })
          }]
        }]
      }]
    };
  }
}

module.exports = Survey;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zdXJ2ZXkuanMiXSwibmFtZXMiOlsic2t5Z2VhciIsInJlcXVpcmUiLCJkYiIsIlN1cnZleSIsImNvbnN0cnVjdG9yIiwicmVjb3JkIiwiX3JlY29yZCIsIlJlY29yZCIsImV4dGVuZCIsImNyZWF0ZSIsInRlYW1JRCIsImZyZXF1ZW5jeSIsImV4Y2x1ZGVkVXNlcnNJRCIsInNjaGVkdWxlZERhdGV0aW1lIiwiaXNTZW50IiwiaXNDbG9zZWQiLCJzYXZlIiwidGhlbiIsIm9mIiwiaWQiLCJxdWVyeSIsIlF1ZXJ5IiwiZXF1YWxUbyIsInJlc3VsdCIsInNjaGVkdWxlZEJ5IiwibGVuZ3RoIiwiRXJyb3IiLCJvcGVuaW5nSW4iLCJyZWFkeVRvU2VuZCIsImxlc3NUaGFuT3JFcXVhbFRvIiwiRGF0ZSIsInJlY29yZHMiLCJpIiwicHVzaCIsIm5ld1ZhbHVlIiwidXBkYXRlIiwic3RhdGUiLCJxMSIsInRleHQiLCJhdHRhY2htZW50cyIsImZhbGxiYWNrIiwiY2FsbGJhY2tfaWQiLCJhY3Rpb25zIiwibmFtZSIsInR5cGUiLCJvcHRpb25zIiwidmFsdWUiLCJKU09OIiwic3RyaW5naWZ5Iiwic2NvcmUiLCJzdXJ2ZXlJRCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTUEsVUFBVUMsUUFBUSxTQUFSLENBQWhCO0FBQ0EsTUFBTUMsS0FBS0QsUUFBUSxNQUFSLENBQVg7O0FBRUEsTUFBTUUsTUFBTixDQUFhO0FBQ1hDLGNBQWFDLE1BQWIsRUFBcUI7QUFDbkIsU0FBS0MsT0FBTCxHQUFlRCxNQUFmO0FBQ0Q7O0FBRUQsYUFBV0UsTUFBWCxHQUFxQjtBQUNuQixXQUFPUCxRQUFRTyxNQUFSLENBQWVDLE1BQWYsQ0FBc0IsUUFBdEIsQ0FBUDtBQUNEOztBQUVELFNBQU9DLE1BQVAsQ0FBZUMsTUFBZixFQUF1QkMsU0FBdkIsRUFBa0NDLGVBQWxDLEVBQW1EQyxpQkFBbkQsRUFBc0U7QUFDcEUsUUFBSUMsU0FBUyxLQUFi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TCxJQUFlLENBQUMsS0FBS0MsUUFBekIsRUFBbUM7QUFDeEMsYUFBTyxRQUFQO0FBQ0QsS0FGTSxNQUVBO0FBQ0wsWUFBTSxJQUFJVyxLQUFKLENBQVUsc0JBQVYsQ0FBTjtBQUNEO0FBQ0Y7O0FBRUQsTUFBSVcsRUFBSixHQUFVO0FBQ1IsV0FBTztBQUNMQyxZQUFNLHVFQUREO0FBRUxDLG1CQUFhLENBQ1g7QUFDRUQsY0FBTSxpREFEUjtBQUVFRSxrQkFBVSxrQ0FGWjtBQUdFQyxxQkFBYSwyQkFIZjtBQUlFQyxpQkFBUyxDQUNQO0FBQ0VDLGdCQUFNLFFBRFI7QUFFRUMsZ0JBQU0sUUFGUjtBQUdFQyxtQkFBUyxDQUNQO0FBQ0VQLGtCQUFNLElBRFI7QUFFRVEsbUJBQU9DLEtBQUtDLFNBQUwsQ0FBZTtBQUNwQkMscUJBQU8sRUFEYTtBQUVwQkMsd0JBQVUsS0FBSy9CO0FBRkssYUFBZjtBQUZULFdBRE87QUFIWCxTQURPO0FBSlgsT0FEVztBQUZSLEtBQVA7QUF5QkQ7QUE3SVU7O0FBZ0piZ0MsT0FBT0MsT0FBUCxHQUFpQmpELE1BQWpCIiwiZmlsZSI6InN1cnZleS5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHNreWdlYXIgPSByZXF1aXJlKCdza3lnZWFyJylcbmNvbnN0IGRiID0gcmVxdWlyZSgnLi9kYicpXG5cbmNsYXNzIFN1cnZleSB7XG4gIGNvbnN0cnVjdG9yIChyZWNvcmQpIHtcbiAgICB0aGlzLl9yZWNvcmQgPSByZWNvcmRcbiAgfVxuXG4gIHN0YXRpYyBnZXQgUmVjb3JkICgpIHtcbiAgICByZXR1cm4gc2t5Z2Vhci5SZWNvcmQuZXh0ZW5kKCdzdXJ2ZXknKVxuICB9XG5cbiAgc3RhdGljIGNyZWF0ZSAodGVhbUlELCBmcmVxdWVuY3ksIGV4Y2x1ZGVkVXNlcnNJRCwgc2NoZWR1bGVkRGF0ZXRpbWUpIHtcbiAgICBsZXQgaXNTZW50ID0gZmFsc2VcbiAgICBsZXQgaXNDbG9zZWQgPSBmYWxzZVxuICAgIGxldCByZWNvcmQgPSBuZXcgU3VydmV5LlJlY29yZCh7XG4gICAgICB0ZWFtSUQsXG4gICAgICBmcmVxdWVuY3ksXG4gICAgICBleGNsdWRlZFVzZXJzSUQsXG4gICAgICBzY2hlZHVsZWREYXRldGltZSxcbiAgICAgIGlzU2VudCxcbiAgICAgIGlzQ2xvc2VkXG4gICAgfSlcbiAgICByZXR1cm4gZGIuc2F2ZShyZWNvcmQpLnRoZW4ocmVjb3JkID0+IG5ldyBTdXJ2ZXkocmVjb3JkKSlcbiAgfVxuXG4gIHN0YXRpYyBvZiAoaWQpIHtcbiAgICBsZXQgcXVlcnkgPSBuZXcgc2t5Z2Vhci5RdWVyeShTdXJ2ZXkuUmVjb3JkKVxuICAgIHF1ZXJ5LmVxdWFsVG8oJ19pZCcsIGlkKVxuICAgIHJldHVybiBkYi5xdWVyeShxdWVyeSkudGhlbihyZXN1bHQgPT4gcmVzdWx0WzBdID8gbmV3IFN1cnZleShyZXN1bHRbMF0pIDogbnVsbClcbiAgfVxuXG4gIHN0YXRpYyBzY2hlZHVsZWRCeSAodGVhbUlEKSB7XG4gICAgbGV0IHF1ZXJ5ID0gbmV3IHNreWdlYXIuUXVlcnkoU3VydmV5LlJlY29yZClcbiAgICBxdWVyeS5lcXVhbFRvKCd0ZWFtSUQnLCB0ZWFtSUQpXG4gICAgcXVlcnkuZXF1YWxUbygnaXNTZW50JywgZmFsc2UpXG4gICAgcmV0dXJuIGRiLnF1ZXJ5KHF1ZXJ5KS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDEpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBNdXRpcGxlIHNjaGVkdWxlZCBzdXJ2ZXlzIGZvdW5kIGZvciB0ZWFtICR7dGVhbUlEfWApXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0WzBdID8gbmV3IFN1cnZleShyZXN1bHRbMF0pIDogbnVsbFxuICAgIH0pXG4gIH1cblxuICBzdGF0aWMgb3BlbmluZ0luICh0ZWFtSUQpIHtcbiAgICBsZXQgcXVlcnkgPSBuZXcgc2t5Z2Vhci5RdWVyeShTdXJ2ZXkuUmVjb3JkKVxuICAgIHF1ZXJ5LmVxdWFsVG8oJ3RlYW1JRCcsIHRlYW1JRClcbiAgICBxdWVyeS5lcXVhbFRvKCdpc1NlbnQnLCB0cnVlKVxuICAgIHF1ZXJ5LmVxdWFsVG8oJ2lzQ2xvc2VkJywgZmFsc2UpXG4gICAgcmV0dXJuIGRiLnF1ZXJ5KHF1ZXJ5KS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDEpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBNdXRpcGxlIG9wZW5pbmcgc3VydmV5cyBmb3VuZCBmb3IgdGVhbSAke3RlYW1JRH1gKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdFswXSA/IG5ldyBTdXJ2ZXkocmVzdWx0WzBdKSA6IG51bGxcbiAgICB9KVxuICB9XG5cbiAgc3RhdGljIGdldCByZWFkeVRvU2VuZCAoKSB7XG4gICAgbGV0IHF1ZXJ5ID0gbmV3IHNreWdlYXIuUXVlcnkoU3VydmV5LlJlY29yZClcbiAgICBxdWVyeS5lcXVhbFRvKCdpc1NlbnQnLCBmYWxzZSlcbiAgICBxdWVyeS5sZXNzVGhhbk9yRXF1YWxUbygnc2NoZWR1bGVkRGF0ZXRpbWUnLCBuZXcgRGF0ZSgpKVxuICAgIHJldHVybiBkYi5xdWVyeShxdWVyeSkudGhlbihyZXN1bHQgPT4ge1xuICAgICAgbGV0IHJlY29yZHMgPSBbXVxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXN1bHQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgcmVjb3Jkcy5wdXNoKG5ldyBTdXJ2ZXkocmVzdWx0W2ldKSlcbiAgICAgIH1cbiAgICAgIHJldHVybiByZWNvcmRzXG4gICAgfSlcbiAgfVxuXG4gIHNldCBpc1NlbnQgKG5ld1ZhbHVlKSB7XG4gICAgdGhpcy5fcmVjb3JkWydpc1NlbnQnXSA9IG5ld1ZhbHVlXG4gIH1cblxuICB1cGRhdGUgKCkge1xuICAgIHJldHVybiBkYi5zYXZlKHRoaXMuX3JlY29yZCkudGhlbihyZWNvcmQgPT4gbmV3IFN1cnZleShyZWNvcmQpKVxuICB9XG5cbiAgZ2V0IGlkICgpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVjb3JkWydpZCddXG4gIH1cblxuICBnZXQgdGVhbUlEICgpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVjb3JkWyd0ZWFtSUQnXVxuICB9XG5cbiAgZ2V0IGZyZXF1ZW5jeSAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlY29yZFsnZnJlcXVlbmN5J11cbiAgfVxuXG4gIGdldCBleGNsdWRlZFVzZXJzSUQgKCkge1xuICAgIHJldHVybiB0aGlzLl9yZWNvcmRbJ2V4Y2x1ZGVkVXNlcnNJRCddXG4gIH1cblxuICBnZXQgc2NoZWR1bGVkRGF0ZXRpbWUgKCkge1xuICAgIHJldHVybiB0aGlzLl9yZWNvcmRbJ3NjaGVkdWxlZERhdGV0aW1lJ11cbiAgfVxuXG4gIGdldCBpc1NlbnQgKCkge1xuICAgIHJldHVybiB0aGlzLl9yZWNvcmRbJ2lzU2VudCddXG4gIH1cblxuICBnZXQgaXNDbG9zZWQgKCkge1xuICAgIHJldHVybiB0aGlzLl9yZWNvcmRbJ2lzQ2xvc2VkJ11cbiAgfVxuXG4gIGdldCBzdGF0ZSAoKSB7XG4gICAgaWYgKCF0aGlzLmlzU2VudCAmJiAhdGhpcy5pc0Nsb3NlZCkge1xuICAgICAgcmV0dXJuICdzY2hlZHVsZWQnXG4gICAgfSBlbHNlIGlmICh0aGlzLmlzU2VudCAmJiAhdGhpcy5pc0Nsb3NlZCkge1xuICAgICAgcmV0dXJuICdvcGVuJ1xuICAgIH0gZWxzZSBpZiAodGhpcy5pc1NlbnQgJiYgIXRoaXMuaXNDbG9zZWQpIHtcbiAgICAgIHJldHVybiAnY2xvc2VkJ1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgc3VydmV5IHN0YXRlJylcbiAgICB9XG4gIH1cblxuICBnZXQgcTEgKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0ZXh0OiAnSG93IGxpa2VseSBpcyBpdCB5b3Ugd291bGQgcmVjb21tZW5kIHRoaXMgY29tcGFueSBhcyBhIHBsYWNlIHRvIHdvcms/JyxcbiAgICAgIGF0dGFjaG1lbnRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0ZXh0OiAnQ2hvb3NlIGEgc2NvcmUgZnJvbSAxMCAoaGlnaHRlc3QpIHRvIDEgKGxvd2VzdCknLFxuICAgICAgICAgIGZhbGxiYWNrOiAnWW91IGFyZSB1bmFibGUgdG8gc2VsZWN0IGEgc2NvcmUnLFxuICAgICAgICAgIGNhbGxiYWNrX2lkOiAnc2F2ZVNjb3JlQW5kUmVxdWVzdFJlYXNvbicsXG4gICAgICAgICAgYWN0aW9uczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBuYW1lOiAnc2NvcmVzJyxcbiAgICAgICAgICAgICAgdHlwZTogJ3NlbGVjdCcsXG4gICAgICAgICAgICAgIG9wdGlvbnM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICB0ZXh0OiAnMTAnLFxuICAgICAgICAgICAgICAgICAgdmFsdWU6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcmU6IDEwLFxuICAgICAgICAgICAgICAgICAgICBzdXJ2ZXlJRDogdGhpcy5pZFxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdXG4gICAgICAgIH1cbiAgICAgIF1cbiAgICB9XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBTdXJ2ZXlcbiJdfQ==